<!DOCTYPE html>

@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@{
    GC.Collect();
    String SessionID = HttpContextAccessor.HttpContext.Request.Cookies["SessionID"];

    if (string.IsNullOrEmpty(SessionID))
    {
        String sid = Classes.UserFunctions.generateSessionID();
        Classes.DBFunctions.sendQuery("INSERT INTO Guests (UserID, SessionID) VALUES('" + Classes.UserFunctions.generateSessionID() + "', '" + sid + "');");
        HttpContextAccessor.HttpContext.Response.Cookies.Append("SessionID", sid);
    }
}

<style>
    #chatbox {
        width: 350px;
        height: 450px;
        background-color: #f1f1f1;
        border: none;
        border-radius: 10px;
        position: absolute;
        right: 20px;
        bottom: 20px;
        overflow: hidden;
        color: white;
    }

    #chatbox-header {
        width: 100%;
        height: 35px;
        background-color: black;
    }

    .message {
        border-radius: 15px;
        width: calc(50% + 1px);
        margin: 10px;
    }

    .message-sent {
        background-color: #a3ccc8;
        float: right;
        color: white;
    }

    .message-recieved {
        background-color: white;
        color: black;
        float: left;
    }

    .message-input {
        border-radius: 20px;
        width: calc(100% - 20px);
        margin: 0 10px;
        position: absolute;
        bottom: 10px;
        background-color: white;
        height: 30px;
        overflow: hidden;
    }
</style>

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="~/lib/fontawesome/css/all.css">
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap-grid.css" />
    <link href="~/lib/bootstrap/bootstrap-tagsinput.css" rel="stylesheet" />
    <link href="~/lib/date-picker/bootstrap-datetimepicker.min.css" rel="stylesheet" />
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.bundle.min.js"></script>


    <script src="~/lib/bootstrap/bootstrap-tagsinput.js"></script>
    <link rel="stylesheet" href="~/css/site.css">
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/date-picker/popper.min.js"></script>
    <script src="~/lib/date-picker/moment.js"></script>
    <script src="~/lib/date-picker/bootstrap-datetimepicker.min.js"></script>
    <script src="~/js/signalr/dist/browser/signalr.js"></script>
    <script src="~/js/chat.js" asp-append-version="true"></script>
    <script src="~/js/main.js" asp-append-version="true"></script>

</head>
<body>


    @if (Classes.UserFunctions.isAdmin(Classes.UserFunctions.getUserID(SessionID))
  && HttpContextAccessor.HttpContext.Request.Path.ToString().Contains("/Admin"))
    {
        <div id="admin-page-layout" class="row">
            <div id="admin-menu" class="d-none d-md-block col-12 col-md-3 col-xl-2">
                <div class="row no-style">
                    <div class="col-12 d-md-none menu-close" onclick="ToggleMenu()"><i class="fas fa-times fa-1-5x"></i></div>
                    <div class="col-12 menu-stats verticle-align">
                        <div class="row verticle-align">
                            <div class="col-4">
                                <p>Orders<br />106</p>
                            </div>
                            <div class="col-4">
                                <p>New<br />80</p>
                            </div>
                            <div class="col-4">
                                <p>Active<br />32</p>
                            </div>

                        </div>
                    </div>
                </div>
                <a href="/Admin/Dashboard">
                    <div class="row admin-menu-item">
                        <div class="col-2 menu-icons"><i class="fas fa-chart-line fa-2x"></i></div>
                        <div class="col-10 menu-header ">
                            <h6>Dashboard</h6>

                        </div>
                    </div>
                </a>
                <a href="/Admin/Orders">
                    <div class="row admin-menu-item">
                        <div class="col-2 menu-icons"><i class="fas fa-clipboard-list fa-2x"></i></div>
                        <div class="col-10 menu-header"><h6>Orders</h6></div>
                    </div>
                </a>
                <a href="/Admin/Products">
                    <div class="row admin-menu-item">
                        <div class="col-2 menu-icons"><i class="fas fa-archive fa-2x"></i></div>
                        <div class="col-10 menu-header"><h6>Products</h6></div>
                    </div>
                </a>
                <a href="/Admin/Promotions">
                    <div class="row admin-menu-item">
                        <div class="col-2 menu-icons"><i class="fas fa-tag fa-2x"></i></div>
                        <div class="col-10 menu-header"><h6>Pomotions</h6></div>
                    </div>
                </a>
                <a href="/Admin/Messages">
                    <div class="row admin-menu-item">
                        <div class="col-2 menu-icons"><i class="fas fa-envelope fa-2x"></i></div>
                        <div class="col-10 menu-header"><h6>Messages</h6></div>
                    </div>
                </a>
                <a href="/Admin/Settings">
                    <div class="row admin-menu-item">
                        <div class="col-2 menu-icons"><i class="fas fa-cog fa-2x"></i></div>
                        <div class="col-10 menu-header"><h6>Settings</h6></div>
                    </div>
                </a>
                <div class="row admin-menu-item">
                    <div class="col-2 menu-icons"><i class="fas fa-power-off fa-2x"></i></div>
                    <div class="col-10 menu-header"><h6>Log Out</h6></div>
                </div>

            </div>
            <div id="admin-page" class="col-12 d-md-block col-md-9 col-xl-10">


                <div class="admin-pages">
                    <div class="menu-toggle d-md-none d-block" onclick="ToggleMenu()"><i class="fas fa-bars fa-1-5x"></i></div>
                    @RenderBody()
                    @RenderSection("Scripts", required: false)
                </div>

            </div>
        </div>


    }
    else
    {

        <div id="chatbox">
            <div id="chatbox-header">
                <p style="float:left; padding:3px; padding-left:10px; font-size:14pt;">Send us a message</p>
                <p style="float:right; padding:3px; padding-right:10px; font-size:14pt;"><b>X</b></p>
            </div>

            <div id="messages" style="height:333px; width:100%; overflow:hidden scroll;">
                @Html.Raw(Classes.Messages.getUserMessages(Classes.UserFunctions.getUserID(SessionID)))
            </div>

            <div class="message-input">
                <input id="message-messageinput" type="text" style="border:none; height:28px; width:84%; margin:0% 5%; float:left;" />
                <p onclick="sendMessage();" style="border:none; height:28px; width:6%; float:right; font-size:13pt; padding:1px; color:black;"><b>></b></p>
            </div>

        </div>

        <!-- if(not logged into admin { )-->
        <!--
        <div id="navbar" style="background-color:#222; width:100%; height:40px;">
            <h3 id="basket-counter" style="color:white; float:right; padding:0px; margin:10px;"
                onclick="window.location.href = '/Basket';">
               
            </h3>
        </div>
        -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="#">OUI OUI</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/index">HOME</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/shop">SHOP</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            ABOUT US
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/login">LOGIN</a>
                    </li>
                </ul>
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item login-logout-btn">
                        <a class="nav-link" onclick="window.location.href = '/Basket';"><i class="fas fa-shopping-cart"></i>@Classes.Basket.getNumOfItems(SessionID)</a>
                    </li>
                </ul>
            </div>
        </nav>

        @RenderBody()
        @RenderSection("Scripts", required: false)



    }
</body>

